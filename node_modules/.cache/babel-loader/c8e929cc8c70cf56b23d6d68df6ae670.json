{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createElementVNode as _createElementVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-1345cbb2\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  style: {\n    \"margin-top\": \"10px\"\n  }\n};\nconst _hoisted_2 = {\n  class: \"box\"\n};\n\nconst _hoisted_3 = /*#__PURE__*/_createTextVNode(\" 上电 \");\n\nconst _hoisted_4 = /*#__PURE__*/_createTextVNode(\" 断电 \");\n\nconst _hoisted_5 = /*#__PURE__*/_createTextVNode(\" 使能机械臂 \");\n\nconst _hoisted_6 = /*#__PURE__*/_createTextVNode(\" 去使能机械臂 \");\n\nconst _hoisted_7 = {\n  class: \"box\"\n};\n\nconst _hoisted_8 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"上电中...\", -1\n/* HOISTED */\n));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createCommentVNode(\" <div>\\n    导航区域\\n    <div v-for=\\\"i in positionsList\\\" :key=\\\"i.id\\\">\\n      <el-button\\n        type=\\\"primary\\\"\\n        style=\\\"margin-top: 5px\\\"\\n        @click=\\\"changeRobotPosition({ destPosition: i.id, cmd: 1 })\\\"\\n        >{{ i.type }}</el-button\\n      >\\n    </div>\\n  </div>\\n  <div style=\\\"margin-top: 10px\\\">\\n    <div>机器人当前状态</div>\\n    {{ robotInfo.robotId ? robotInfo : initRobotInfo }}\\n  </div>\\n  <div v-if=\\\"polling\\\" style=\\\"margin-top: 10px\\\">\\n    <el-button>暂停导航</el-button><el-button>结束导航</el-button>\\n  </div>\\n  <div v-if=\\\"navResult\\\" style=\\\"margin-top: 10px\\\">\\n    <div>导航已结束，当前状态:{{ codeMessage[navResult.errCode] }}</div>\\n  </div> \"), _createElementVNode(\"div\", _hoisted_1, [_createCommentVNode(\" <div>机械臂控制</div> \"), _createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_button, {\n    onClick: _cache[0] || (_cache[0] = $event => $options.controlArm(0, 'powerOn', true, 'flag')),\n    class: \"task-button\",\n    disabled: $data.robotInfo.armPowerOn\n  }, {\n    default: _withCtx(() => [_hoisted_3]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"disabled\"]), _createVNode(_component_el_button, {\n    onClick: _cache[1] || (_cache[1] = $event => $options.controlArm(0, 'powerOn', false)),\n    class: \"task-button\",\n    disabled: !$data.robotInfo.armPowerOn\n  }, {\n    default: _withCtx(() => [_hoisted_4]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"disabled\"]), _createVNode(_component_el_button, {\n    onClick: _cache[2] || (_cache[2] = $event => $options.controlArm(1, 'enable', true)),\n    class: \"task-button\",\n    disabled: $data.robotInfo.armEnabled || !$data.robotInfo.armPowerOn\n  }, {\n    default: _withCtx(() => [_hoisted_5]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"disabled\"]), _createVNode(_component_el_button, {\n    onClick: _cache[3] || (_cache[3] = $event => $options.controlArm(1, 'enable', false)),\n    class: \"task-button\",\n    disabled: !$data.robotInfo.armEnabled\n  }, {\n    default: _withCtx(() => [_hoisted_6]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"disabled\"])]), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", {\n    onClick: _cache[4] || (_cache[4] = (...args) => $options.onDeleteErrors && $options.onDeleteErrors(...args)),\n    class: \"task-button\"\n  }, \"清错\"), _createElementVNode(\"div\", {\n    onTouchstart: _cache[5] || (_cache[5] = (...args) => $options.onArmBackOrigin && $options.onArmBackOrigin(...args)),\n    onTouchend: _cache[6] || (_cache[6] = (...args) => $options.onArmBackOriginEnd && $options.onArmBackOriginEnd(...args)),\n    class: \"task-button\"\n  }, \" 机械臂长按回原点 \", 32\n  /* HYDRATE_EVENTS */\n  ), _createElementVNode(\"div\", {\n    class: \"task-button\",\n    onClick: _cache[7] || (_cache[7] = $event => $options.startArmZeroForce(true))\n  }, \" 开启零力示教 \"), _createElementVNode(\"div\", {\n    class: \"task-button\",\n    onClick: _cache[8] || (_cache[8] = $event => $options.startArmZeroForce(false))\n  }, \" 关闭零力示教 \")]), _createVNode(_component_el_dialog, {\n    modelValue: $data.dialogVisible,\n    \"onUpdate:modelValue\": _cache[9] || (_cache[9] = $event => $data.dialogVisible = $event),\n    title: \"Tips\",\n    width: \"30%\"\n  }, {\n    default: _withCtx(() => [_hoisted_8]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"modelValue\"]), _createCommentVNode(\" <el-button @click=\\\"controlArm(1, 'enable', true)\\\">使能机械臂</el-button>\\n    <el-button @click=\\\"controlArm(1, 'enable', false)\\\">去使能机械臂</el-button>\\n    <el-button @click=\\\"controlArm(0, 'powerOn', true)\\\">上电</el-button>\\n    <el-button @click=\\\"controlArm(0, 'powerOn', false)\\\">断电</el-button>\\n    <el-button @click=\\\"controlArm(2, 'stop', true)\\\"\\n      >停止机械臂当前动作</el-button\\n    > \")])], 2112\n  /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */\n  );\n}","map":{"version":3,"mappings":";;;;;AAsBOA,OAAwB,EAAxB;AAAA;AAAA;;;AAEEC,OAAK,EAAC;;;iDAKR;;iDAOA;;iDAOA;;iDAOA;;;AAIEA,OAAK,EAAC;;;gEAiBLC,oBAAmB,MAAnB,EAAmB,IAAnB,EAAM,QAAN,EAAY;AAAA;AAAZ;;;;;;;6DAtERC,mrBAqBAD,oBA0DM,KA1DN,cA0DM,CAzDJC,yCAyDI,EAxDJD,oBA6BM,KA7BN,cA6BM,CA5BJE,aAMYC,oBANZ,EAMY;AALTC,WAAK,sCAAEC,oBAAU,CAAV,EAAU,SAAV,EAAU,IAAV,EAAU,MAAV,CAAF,CAKI;AAJVN,SAAK,EAAC,aAII;AAHTO,YAAQ,EAAEC,gBAAUC;AAGX,GANZ;sBAIC,MAED;;;;GANA;;AAAA,iBA4BI,EArBJN,aAMYC,oBANZ,EAMY;AALTC,WAAK,sCAAEC,oBAAU,CAAV,EAAU,SAAV,EAAU,KAAV,CAAF,CAKI;AAJVN,SAAK,EAAC,aAII;AAHTO,YAAQ,GAAGC,gBAAUC;AAGZ,GANZ;sBAIC,MAED;;;;GANA;;AAAA,iBAqBI,EAdJN,aAMYC,oBANZ,EAMY;AALTC,WAAK,sCAAEC,oBAAU,CAAV,EAAU,QAAV,EAAU,IAAV,CAAF,CAKI;AAJVN,SAAK,EAAC,aAII;AAHTO,YAAQ,EAAEC,gBAAUE,UAAV,IAAoB,CAAKF,gBAAUC;AAGpC,GANZ;sBAIC,MAED;;;;GANA;;AAAA,iBAcI,EAPJN,aAMYC,oBANZ,EAMY;AALTC,WAAK,sCAAEC,oBAAU,CAAV,EAAU,QAAV,EAAU,KAAV,CAAF,CAKI;AAJVN,SAAK,EAAC,aAII;AAHTO,YAAQ,GAAGC,gBAAUE;AAGZ,GANZ;sBAIC,MAED;;;;GANA;;AAAA,iBAOI,CA7BN,CAwDI,EA1BJT,oBAeM,KAfN,cAeM,CAdJA,oBAAyD,KAAzD,EAAyD;AAAnDI,WAAK,yCAAEC,2DAAF,CAA8C;AAA5BN,SAAK,EAAC;AAAsB,GAAzD,EAAiD,IAAjD,CAcI,EAbJC,oBAMM,KANN,EAMM;AALHU,gBAAU,yCAAEL,6DAAF,CAKP;AAJHM,cAAQ,yCAAEN,mEAAF,CAIL;AAHJN,SAAK,EAAC;AAGF,GANN,EAIC,YAJD,EAMA;AAAA;AANA,GAaI,EANJC,oBAEM,KAFN,EAEM;AAFDD,SAAK,EAAC,aAEL;AAFoBK,WAAK,sCAAEC,2BAAiB,IAAjB,CAAF;AAEzB,GAFN,EAA0D,UAA1D,CAMI,EAHJL,oBAEM,KAFN,EAEM;AAFDD,SAAK,EAAC,aAEL;AAFoBK,WAAK,sCAAEC,2BAAiB,KAAjB,CAAF;AAEzB,GAFN,EAA2D,UAA3D,CAGI,CAfN,CA0BI,EAVHH,aAEaU,oBAFb,EAEa;gBAFOL,mBAEP;+DAFOA,sBAAaM,OAEpB;AAFsBC,SAAK,EAAC,MAE5B;AAFmCC,SAAK,EAAC;AAEzC,GAFb;sBACK,MAAmB,CAAnBC,UAAmB;;;;GADxB;;AAAA,mBAUG,EAPJf,yZAOI,CA1DN","names":["style","class","_createElementVNode","_createCommentVNode","_createVNode","_component_el_button","onClick","$options","disabled","$data","armPowerOn","armEnabled","onTouchstart","onTouchend","_component_el_dialog","$event","title","width","_hoisted_8"],"sourceRoot":"","sources":["D:\\Program Files\\web\\prj\\sendRobot\\src\\pages\\Dashboard\\components\\RobotOperation.vue"],"sourcesContent":["<template>\n  <!-- <div>\n    导航区域\n    <div v-for=\"i in positionsList\" :key=\"i.id\">\n      <el-button\n        type=\"primary\"\n        style=\"margin-top: 5px\"\n        @click=\"changeRobotPosition({ destPosition: i.id, cmd: 1 })\"\n        >{{ i.type }}</el-button\n      >\n    </div>\n  </div>\n  <div style=\"margin-top: 10px\">\n    <div>机器人当前状态</div>\n    {{ robotInfo.robotId ? robotInfo : initRobotInfo }}\n  </div>\n  <div v-if=\"polling\" style=\"margin-top: 10px\">\n    <el-button>暂停导航</el-button><el-button>结束导航</el-button>\n  </div>\n  <div v-if=\"navResult\" style=\"margin-top: 10px\">\n    <div>导航已结束，当前状态:{{ codeMessage[navResult.errCode] }}</div>\n  </div> -->\n  <div style=\"margin-top: 10px\">\n    <!-- <div>机械臂控制</div> -->\n    <div class=\"box\">\n      <el-button\n        @click=\"controlArm(0, 'powerOn', true,'flag')\"\n        class=\"task-button\"\n        :disabled=\"robotInfo.armPowerOn\"\n      >\n        上电\n      </el-button>\n      <el-button\n        @click=\"controlArm(0, 'powerOn', false)\"\n        class=\"task-button\"\n        :disabled=\"!robotInfo.armPowerOn\"\n      >\n        断电\n      </el-button>\n      <el-button\n        @click=\"controlArm(1, 'enable', true)\"\n        class=\"task-button\"\n        :disabled=\"robotInfo.armEnabled || !robotInfo.armPowerOn\"\n      >\n        使能机械臂\n      </el-button>\n      <el-button\n        @click=\"controlArm(1, 'enable', false)\"\n        class=\"task-button\"\n        :disabled=\"!robotInfo.armEnabled\"\n      >\n        去使能机械臂\n      </el-button>\n    </div>\n    <div class=\"box\">\n      <div @click=\"onDeleteErrors\" class=\"task-button\">清错</div>\n      <div\n        @touchstart=\"onArmBackOrigin\"\n        @touchend=\"onArmBackOriginEnd\"\n        class=\"task-button\"\n      >\n        机械臂长按回原点\n      </div>\n      <div class=\"task-button\" @click=\"startArmZeroForce(true)\">\n        开启零力示教\n      </div>\n      <div class=\"task-button\" @click=\"startArmZeroForce(false)\">\n        关闭零力示教\n      </div>\n    </div>\n     <el-dialog v-model=\"dialogVisible\" title=\"Tips\" width=\"30%\">\n          <span>上电中...</span>\n      </el-dialog>\n    <!-- <el-button @click=\"controlArm(1, 'enable', true)\">使能机械臂</el-button>\n    <el-button @click=\"controlArm(1, 'enable', false)\">去使能机械臂</el-button>\n    <el-button @click=\"controlArm(0, 'powerOn', true)\">上电</el-button>\n    <el-button @click=\"controlArm(0, 'powerOn', false)\">断电</el-button>\n    <el-button @click=\"controlArm(2, 'stop', true)\"\n      >停止机械臂当前动作</el-button\n    > -->\n  </div>\n</template>\n\n<script>\n/* eslint-disable no-unused-vars */\nimport { ElMessage } from \"element-plus\";\nimport {\n  getRobotInfoApi,\n  robotNavigationApi,\n  getNavigationResultApi,\n  ctrlArmApi,\n  deleteErrors,\n  armBackOrigin,\n  armEndOrigin,\n  startArmZeroForce,\n} from \"@/service/robot\";\nimport { codeMessage } from \"@/utils/request\";\nexport default {\n  name: \"RobotOperation\",\n  props: {\n    positionsList: Array,\n    drawPoint: Function,\n    calculatePointPosition: Function,\n    initRobotInfo: Object,\n  },\n  data() {\n    return {\n      dialogVisible:false,\n      timer: null,\n      //机械臂是否已上电\n      disabledarmPowerOn: false,\n      // 机械臂是否已使能\n      disablearmEnabled: false,\n      codeMessage: codeMessage,\n      robotInfo: {},\n      currentNavRequestId: \"\",\n      navResult: null,\n      polling: null,\n      navCmdMap: {\n        1: \"开始\",\n        2: \"暂停\",\n        3: \"继续\",\n        4: \"结束\",\n      },\n      validParam: {\n        0: \"powerOn\",\n        1: \"enable\",\n        2: \"stop\",\n        3: \"clearFaults\",\n      },\n    };\n  },\n  methods: {\n    \n    endLoading(loading){\n      loading.close()\n    },\n    startLoading(){\n      const loading = this.$loading({\n        lock:true,\n        text:\"上电中...\",\n        background:\"rgba(0,0,0,0.7)\"\n      })\n      return loading\n    },\n    async startArmZeroForce(flag) {\n      const res = await startArmZeroForce({ param: flag });\n      if (res.code === 0) {\n        ElMessage({\n          message: `操作成功`,\n          type: \"success\",\n        });\n      }\n    },\n    async onArmBackOriginEnd() {\n      // console.log('end')\n      const res = await armEndOrigin({ cmd: 3 });\n    },\n    async onArmBackOrigin() {\n      // console.log(111)\n      const res = await armBackOrigin();\n      if (res.code === 0) {\n        ElMessage({\n          message: `操作成功`,\n          type: \"success\",\n        });\n      }\n    },\n    async onDeleteErrors() {\n      const res = await deleteErrors();\n      if (res.code === 0) {\n        ElMessage({\n          message: `操作成功`,\n          type: \"success\",\n        });\n      }\n    },\n    async getRobotInfo() {\n      const { data } = await getRobotInfoApi();\n      this.robotInfo = data;\n      // const { x, y } = this.calculatePointPosition(data.x, data.y);\n      // // 渲染机器人位置\n      // this.drawPoint(x, y, 20);\n      return data\n    },\n     mySetInterval() {\n      this.getRobotInfo()\n      this.timer = setTimeout(()=>this.mySetInterval(), 1000);\n    },\n    async changeRobotPosition({ destPosition, cmd }) {\n      this.navResult = null;\n      const res = await robotNavigationApi({ destPosition, cmd });\n      const { data, code } = res;\n      this.currentNavRequestId = data.requestId;\n      if (code === 0) {\n        ElMessage({\n          message: `设置导航点成功，当前目标点：${\n            this.positionsList.find((i) => i.id === destPosition).type\n          }`,\n          type: \"success\",\n        });\n        this.startPolling();\n      }\n    },\n    async getNavResultAndPosition() {\n      // 轮询状态接口 如果接收到数据则说明导航结束了，停止轮询\n      this.getRobotInfo();\n      const res = await getNavigationResultApi();\n      if (res.requestId === this.currentNavRequestId) {\n        // 请求id校验\n        this.navResult = res;\n      }\n    },\n    async controlArm(validParam, action, status,flag) {\n      await ctrlArmApi({ validParam, [action]: status, armIndex: 0 });\n      if(flag=='flag'){\n        // this.startLoading()\n        console.log(1111)\n        this.dialogVisible = true\n      }\n      //TODO 这里应该查询/轮询机器人状态？\n    },\n    startPolling() {\n      this.polling = setInterval(() => {\n        this.getNavResultAndPosition();\n      }, 1000); //1秒查询一次\n    },\n    \n  },\n  beforeUnmount() {\n    clearTimeout(this.timer);\n    this.timer = null;\n  },\n  mounted() {\n    // 机器人初始信息通过父组件传过来 避免第一次加载地图可能点渲染不上\n    clearTimeout(this.timer)\n    this.timer = null\n    this.mySetInterval()\n  },\n  watch: {\n    navResult(newVal, oldVal) {\n      // 轮询状态 如果接收到数据则说明导航结束了，停止轮询\n      if (newVal) {\n        ElMessage({\n          message: `导航已经结束，当前状态：${codeMessage[newVal.errCode]}`,\n          type: \"success\",\n        });\n        clearTimeout(this.polling);\n        this.polling = null;\n      }\n    },\n    robotInfo(newVal, oldVal) {\n      console.log(\"new\",newVal)\n      this.robotInfo = newVal;\n      if(newVal.armPowerOn&&!oldVal.armPowerOn){\n        this.dialogVisible = false\n      }\n    },\n  },\n};\n</script>\n\n<style scoped lang='scss'>\n.box {\n  width: 100%;\n  display: flex;\n  margin: 0 auto;\n  .task-button {\n    width: 261px;\n    height: 147px;\n    background: linear-gradient(180deg, #f2f8ff 0%, #ffffff 112.66%);\n    box-shadow: 0px 0px 5px rgba(184, 190, 217, 0.5);\n    border-radius: 20.0355px;\n    border: 2px solid #9abdf8;\n    margin-left: 40px;\n    margin-top: 50px;\n    text-align: center;\n    line-height: 147px;\n    font-size: 20px;\n  }\n}\n</style>"]},"metadata":{},"sourceType":"module"}